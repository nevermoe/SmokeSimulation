cscope 15 $HOME/Documents/File/research/smoke_rendered -q 0000000612 0000044568
	@arcball.cpp

1 
	#_USE_MATH_DEFINES


	)

3 
	~"cÜe.h
"

4 
	~"¬cb®l.h
"

10 
	gArcb®l
::
	$Arcb®l
()

12 
this
->
b®lRadius
=600;

13 
isRÙ©šg
=
çl£
;

14 
zoomR©e
 = 0.003;

15 
width
=
height
=0;

16 
	`Re£t
();

17 
	}
}

25 
	gArcb®l
::
	$S‘WidthHeight
(
w
, 
h
)

27 
width
=
w
;

28 
height
=
h
;

29 
b®lRadius
 = 
¡d
::
	`mš
(()(
w
/2), ()(
h
/2));

30 
	}
}

37 
	gArcb®l
::
	$S‘Radius
(
ÃwRadius
)

39 
b®lRadius
 = 
ÃwRadius
;

40 
	}
}

42 
	gArcb®l
::
	$S¹Zoomšg
(
x
, 
y
)

45 
	`glG‘Flßtv
(
GL_MODELVIEW_MATRIX
, 
¡¬tM©rix
);

47 
¡¬tZoomX
 = 
x
;

48 
¡¬tZoomY
 = 
y
;

49 
isZoomšg
 = 
Œue
;

50 
	}
}

52 
	gArcb®l
::
	$Upd©eZoomšg
(
x
, 
y
)

54 ià(
isZoomšg
) {

55 
	`glM©rixMode
(
GL_MODELVIEW
);

56 
	`glLßdId’t™y
();

57 
	`glT¿n¦©ef
(0.0f, 0.0f, 
zoomR©e
 * (
x
 - 
¡¬tZoomX
) );

59 
	`AµlyRÙ©iÚM©rix
();

60 
	}
}

62 
	gArcb®l
::
	$StİZoomšg
()

64 
isZoomšg
 = 
çl£
;

65 
	}
}

75 
	gArcb®l
::
	$S¹RÙ©iÚ
(
_x
, 
_y
)

77 
x
 = ( (
_x
)-(
width
/2) );

78 
y
 = ((
height
/2)-
_y
);

81 
	`glG‘Flßtv
(
GL_MODELVIEW_MATRIX
, 
¡¬tM©rix
);

83 
¡¬tRÙ©iÚVeùÜ
 = 
	`CÚv”tXY
(
x
,
y
);

84 
¡¬tRÙ©iÚVeùÜ
.
	`nÜm®ize
();

86 
cu¼’tRÙ©iÚVeùÜ
ğ
¡¬tRÙ©iÚVeùÜ
;

87 
isRÙ©šg
 = 
Œue
;

89 
	}
}

98 
	gArcb®l
::
	$Upd©eRÙ©iÚ
(
_x
, 
_y
)

100 
x
 = ( (
_x
)-(
width
/2) );

101 
y
 = ((
height
/2)-
_y
);

103 
cu¼’tRÙ©iÚVeùÜ
 = 
	`CÚv”tXY
(
x
,
y
);

105 
cu¼’tRÙ©iÚVeùÜ
.
	`nÜm®ize
();

108 
	`glM©rixMode
(
GL_MODELVIEW
);

109 
	`glLßdId’t™y
();

110 
	`AµlyRÙ©iÚM©rix
();

111 
	}
}

119 
	gArcb®l
::
	$AµlyRÙ©iÚM©rix
()

122 
	`glMuÉM©rixf
(
¡¬tM©rix
);

124 ià(
isRÙ©šg
) {

127 iàĞĞ
cu¼’tRÙ©iÚVeùÜ
 - 
¡¬tRÙ©iÚVeùÜ
).
	`nÜm
() > 1E-6 ) {

128 
Eig’
::
VeùÜ3d
 
rÙ©iÚAxis
 = 
cu¼’tRÙ©iÚVeùÜ
.
	`üoss
(
¡¬tRÙ©iÚVeùÜ
);

129 
rÙ©iÚAxis
.
	`nÜm®ize
();

132 
Eig’
::
M©rix3d
 
sm
;

133 
i
 = 0 ; i < 3 ; i++)

134 
j
 = 0 ; j < 3 ; j++)

135 
	`sm
(
i
,
j
èğ()
¡¬tM©rix
[4*i+j];

136 
rÙ©iÚAxis
 = 
sm
 *„otationAxis;

138 
v®
 = 
cu¼’tRÙ©iÚVeùÜ
.
	`dÙ
(
¡¬tRÙ©iÚVeùÜ
);

139 
v®
 > (1-1E-10) ? val=1.0 : val=val ;

140 
rÙ©iÚAngË
 = 
	`acos
(
v®
è* 180.0f/()
M_PI
;

143 
	`glRÙ©ef
(
rÙ©iÚAngË
 * 2, -
rÙ©iÚAxis
.
	`x
(), -rÙ©iÚAxis.
	`y
(),-rÙ©iÚAxis.
	`z
());

146 
	}
}

153 
	gArcb®l
::
	$StİRÙ©iÚ
()

155 
	`glM©rixMode
(
GL_MODELVIEW
);

156 
	`glLßdId’t™y
();

157 
	`AµlyRÙ©iÚM©rix
();

158 
isRÙ©šg
 = 
çl£
;

159 
	}
}

162 
	gEig’
::
VeùÜ3d
 
Arcb®l
::
	$CÚv”tXY
(
x
, 
y
)

165 
d
 = 
x
*x+
y
*y;

166 
¿diusSqu¬ed
 = 
b®lRadius
*ballRadius;

167 ià(
d
 > 
¿diusSqu¬ed
) {

168  
Eig’
::
	`VeùÜ3d
(()
x
,()
y
, 0 );

171  
Eig’
::
	`VeùÜ3d
(()
x
,()
y
, 
	`sq¹
(
¿diusSqu¬ed
 - 
d
));

173 
	}
}

179 
	gArcb®l
::
	$Re£t
()

181 
fov
 = 
INITIAL_FOV
;

183 
	`mem£t
(
¡¬tM©rix
, 0, (startMatrix));

184 
¡¬tM©rix
[0] = 1;

185 
¡¬tM©rix
[1] =0;

186 
¡¬tM©rix
[2] = 0;

187 
¡¬tM©rix
[3] = 0;

188 
¡¬tM©rix
[4] = 0;

189 
¡¬tM©rix
[5] =1;

190 
¡¬tM©rix
[6] = 0;

191 
¡¬tM©rix
[7] = 0;

192 
¡¬tM©rix
[8] = 0;

193 
¡¬tM©rix
[9] =0;

194 
¡¬tM©rix
[10] = 1;

195 
¡¬tM©rix
[11] = 0;

196 
¡¬tM©rix
[12] = 0;

197 
¡¬tM©rix
[13] =0;

198 
¡¬tM©rix
[14] = 0;

199 
¡¬tM©rix
[15] = 1;

201 
ŒªsX
 = 
ŒªsY
 = 0;

202 
¡¬tZoomX
 = 
¡¬tZoomY
 = 
cu¼’tT¿nsX
 = 
cu¼’tT¿nsY
 = 0;

203 
	}
}

206 cÚ¡ 
	gArcb®l
::
INITIAL_FOV
 = 30;

207 cÚ¡ 
	gArcb®l
::
TRANSLATION_FACTOR
 = 0.01f;

	@arcball.h

1 #iâdeà
_ARCBALL_H


2 
	#_ARCBALL_H


	)

86 
	~"cÜe.h
"

88 
	tGLM©rix
[16];

90 şas 
	cArcb®l


92 
	m´iv©e
:

93 
fov
;

94 
	mfovS¹Y
;

95 
	mfovCu¼’tY
;

97 
	mzoomR©e
;

98 
	mŒªsX
, 
	mŒªsY
;

99 
	mcu¼’tT¿nsX
, 
	mcu¼’tT¿nsY
;

100 
	m¡¬tZoomX
, 
	m¡¬tZoomY
;

102 
GLM©rix
 
	m¡¬tM©rix
;

103 
GLM©rix
 
	mcu¼’tM©rix
;

104 
	mEig’
::
VeùÜ3d
 
¡¬tRÙ©iÚVeùÜ
;

105 
	mEig’
::
VeùÜ3d
 
cu¼’tRÙ©iÚVeùÜ
;

107 
	mEig’
::
VeùÜ2f
 
¡¬tT¿n¦©iÚVeùÜ
;

108 
	mEig’
::
VeùÜ2f
 
cu¼’tT¿n¦©iÚVeùÜ
;

110 
boŞ
 
	misZoomšg
;

111 
boŞ
 
	misRÙ©šg
;

112 
	mb®lRadius
;

113 
	m»sidu®Spš
;

114 cÚ¡ 
	mINITIAL_FOV
;

115 cÚ¡ 
	mMINIMAL_FOV
;

116 cÚ¡ 
	mTRANSLATION_FACTOR
;

118 
	mEig’
::
VeùÜ3d
 
CÚv”tXY
(
x
, 
y
);

119 
	mwidth
, 
	mheight
;

120 
	mpublic
:

121 
Arcb®l
();

123 
S‘WidthHeight
(
w
, 
h
);

124 
S¹RÙ©iÚ
(
x
, 
y
);

125 
Upd©eRÙ©iÚ
(
x
, 
y
);

126 
StİRÙ©iÚ
();

128 
S¹Zoomšg
(
x
, 
y
);

129 
Upd©eZoomšg
(
x
, 
y
);

130 
StİZoomšg
();

133 
AµlyRÙ©iÚM©rix
();

135 
S‘Radius
(
ÃwRadius
);

136 
Re£t
();

	@camera.cpp

1 
	~"cÜe.h
"

2 
	~"ÿm”a.h
"

4 
	gCam”a
::
	$Cam”a
(
GLFWwšdow
* 
wšdowHªdË
) {

5 #ifdeà
DEBUG_LEVEL


6 
¡d
::
cout
 << 
__FILE__
 << " " << 
__FUNCTION__
 << std::
’dl
;

8 
wšdowHªdË_
 = 
wšdowHªdË
;

11 
	`Re£t
();

12 
	}
}

14 
	gCam”a
::
	$S‘Light
()

17 cÚ¡ 
GLæßt
 
light_pos™iÚ
[] = {2.0f, 1.0f, 10.0f, 1.0f};

18 cÚ¡ 
GLæßt
 
light_amb›Á
[] = {0.2f, 0.2f, 0.2f, 1.0f};

19 cÚ¡ 
GLæßt
 
light_diffu£
[] = {1.0f, 1.0f, 0.0f, 1.0f};

20 cÚ¡ 
GLæßt
 
light_¥ecuÏr
[] = {1.0f, 0.0f, 1.0f, 1.0f};

22 
	`glLightfv
(
GL_LIGHT0
, 
GL_POSITION
, 
light_pos™iÚ
);

23 
	`glLightfv
(
GL_LIGHT0
, 
GL_AMBIENT
, 
light_amb›Á
);

24 
	`glLightfv
(
GL_LIGHT0
, 
GL_DIFFUSE
, 
light_diffu£
);

25 
	`glLightfv
(
GL_LIGHT0
, 
GL_SPECULAR
, 
light_¥ecuÏr
);

45 
	`glEÇbË
(
GL_LIGHTING
);

46 
	`glEÇbË
(
GL_LIGHT0
);

47 
	}
}

49 
	gCam”a
::
	$Regi¡”P¬’tWšdow
(
GLFWwšdow
* 
wšdowHªdË
)

51 
wšdowHªdË_
 = 
wšdowHªdË
;

52 
	}
}

54 
	gCam”a
::
	$Re£t
()

57 
	`glfwG‘WšdowSize
(
wšdowHªdË_
, &
wšX_
, &
wšY_
);

58 
FOV_
 = 60.0f;

59 
a¥eù_
 = (
GLæßt
)
wšX_
 / 
wšY_
;

60 
Ã¬Cl_
 = 0.1f;

61 
çrCl_
 = 100.0f;

64 
	`glEÇbË
(
GL_DEPTH_TEST
);

66 
	`glDi§bË
(
GL_DEPTH_TEST
);

68 
	`glM©rixMode
(
GL_PROJECTION
);

69 
	`glLßdId’t™y
();

72 
	`gluP”¥eùive
(
FOV_
, 
a¥eù_
, 
Ã¬Cl_
, 
çrCl_
);

74 
	`glV›wpÜt
(0, 0, 
wšX_
, 
wšY_
);

76 
	`glCË¬
(
GL_COLOR_BUFFER_BIT
 | 
GL_DEPTH_BUFFER_BIT
);

78 
	}
}

80 
	gCam”a
::
	$S‘A¥eù
(
GLæßt
 
a¥eù
)

82 
a¥eù_
 = 
a¥eù
;

83 
	}
}

	@camera.h

1 #iâdeà
CAMERA_H


2 
	#CAMERA_H


	)

4 
	~"cÜe.h
"

6 şas 
	cCam”a
 {

7 
	mpublic
:

8 
Cam”a
(
GLFWwšdow
* 
wšdowHªdË
);

10 
Re£t
();

11 
S‘Light
();

12 
Regi¡”P¬’tWšdow
(
GLFWwšdow
* 
wšdowHªdË
);

16 
S‘A¥eù
(
GLæßt
 
a¥eù
);

18 
	m´iv©e
:

20 
GLæßt
 
FOV_
;

21 
GLæßt
 
	ma¥eù_
;

22 
GLæßt
 
	mÃ¬Cl_
;

23 
GLæßt
 
	mçrCl_
;

24 
	mwšX_
;

25 
	mwšY_
;

28 
GLFWwšdow
* 
	mwšdowHªdË_
;

	@controller.cpp

1 
	~"cÜe.h
"

2 
	~"cÚŒŞËr.h
"

4 
CÚŒŞËr
* 
g_cÚŒŞËr
;

7 
	$”rÜ_ÿÎback
(
”rÜ
, cÚ¡ * 
desütiÚ
)

9 
	`åuts
(
desütiÚ
, 
¡d”r
);

10 
	}
}

12 
	$»size
(
GLFWwšdow
 *
wšdow
, 
x
,
y
)

14 ::
g_cÚŒŞËr
->
	`Resize
(
wšdow
, 
x
, 
y
);

15 
	}
}

17 
	$keybßrd
(
GLFWwšdow
 * 
wšdow
, 
key
, 
sÿncode
,
aùiÚ
, 
mods
)

19 ::
g_cÚŒŞËr
->
	`Keybßrd
(
wšdow
, 
key
, 
sÿncode
, 
aùiÚ
, 
mods
);

20 
	}
}

22 
	$mou£bu‰Ú
(
GLFWwšdow
 *
wšdow
,
bu‰Ú
,
aùiÚ
,
mods
)

24 ::
g_cÚŒŞËr
->
	`Mou£Bu‰Ú
(
wšdow
, 
bu‰Ú
, 
aùiÚ
, 
mods
);

25 
	}
}

27 
	$mou£mÙiÚ
(
GLFWwšdow
 *
wšdow
, 
x
, 
y
)

29 ::
g_cÚŒŞËr
->
	`Mou£MÙiÚ
(
wšdow
, 
x
, 
y
);

30 
	}
}

32 
	gCÚŒŞËr
::
	$Regi¡”Objeù
(
Objeù
* 
objeù
)

34 
objeù
->
	`Regi¡”P¬’tWšdow
(
wšdowHªdË_
);

35 
objeù
->
	`Re£t
();

36 
objeùs_
[
objeùNo_
++] = 
objeù
;

37 
aùiveObj_
++;

38 
	}
}

41 
	gCÚŒŞËr
::
	$CÚŒŞËr
(
¬gc
,**
¬gv
, cÚ¡ *
wšdowName
)

43 
wšdowName_
 = 
wšdowName
;

46 
–­£dTime_
 = 0;

47 
numOfF¿me_
 = 0;

48 
ås_
 = 0;

50 
wšX_
 = 1280;

51 
wšY_
 = 960;

53 
aùiveObj_
 = -1;

54 
objeùNo_
 = 0;

55 
maxObjeùNo_
 = 100;

56 
objeùs_
 = 
Ãw
 
Objeù
*[
maxObjeùNo_
];

58 
isCŒlP»s£d_
 = 
isLeáKeyP»s£d_
 = 
isMiddËKeyP»s£d_
 = 
isRightKeyP»s£d_
 = 
çl£
;

59 
isLightOn_
 = 
Œue
;

60 
´evX_
 = 
´evY_
 = 0;

63 ià(!
	`glfwIn™
()) {

64 
¡d
::
û¼
 << "glfwIn™(èçed!" << std::
’dl
;

65 
	`ex™
(-1);

69 
wšdowHªdË_
 = 
	`glfwC»©eWšdow
(
wšX_
, 
wšY_
, 
wšdowName
, 
NULL
, NULL);

70 ià(!
wšdowHªdË_
) {

71 
¡d
::
û¼
 << "C»©Wšdow faed" << std::
’dl
;

72 
	`ex™
(-1);

74 
	`glfwMakeCÚ‹xtCu¼’t
(
wšdowHªdË_
);

75 
	`glfwS‘WšdowPos
(
wšdowHªdË_
, 0, 0);

78 
	`glCË¬CŞÜ
( 0., 0., 0., 1. );

81 
	`glfwS‘E¼ÜC®lback
(
”rÜ_ÿÎback
);

82 
	`glfwS‘Mou£Bu‰ÚC®lback
(
wšdowHªdË_
, 
mou£bu‰Ú
);

83 
	`glfwS‘CursÜPosC®lback
(
wšdowHªdË_
, 
mou£mÙiÚ
);

84 
	`glfwS‘KeyC®lback
(
wšdowHªdË_
, 
keybßrd
);

85 
	`glfwS‘WšdowSizeC®lback
(
wšdowHªdË_
, 
»size
);

87 if(
	`gËwIn™
(è!ğ
GLEW_OK
) {

88 
¡d
::
û¼
 << "gËwIn™(èçed!" << std::
’dl
;

89 
	`ex™
(-1);

93 
	}
}

95 
	gCÚŒŞËr
::
	$In™Cam”a
()

97 
ÿm”a_
 = 
Ãw
 
	`Cam”a
(
wšdowHªdË_
);

98 
	}
}

100 
	gCÚŒŞËr
::
	$BegšLoİ
()

102 !
	`glfwWšdowShouldClo£
(
wšdowHªdË_
))

105 ::
g_cÚŒŞËr
->
	`R’d”
();

108 
	`glfwSw­Bufãrs
(
wšdowHªdË_
);

111 
	`glfwPŞlEv’ts
();

113 
	}
}

117 
	gCÚŒŞËr
::~
	$CÚŒŞËr
() {

118 
	`glFšish
();

119 
	`glfwDe¡royWšdow
(
wšdowHªdË_
);

120 
	`glfwT”mš©e
();

121 
	}
}

123 
	gCÚŒŞËr
::
	$Re£t
() {

124 #ifdeà
DEBUG_LEVEL


125 
¡d
::
cout
 << 
__FILE__
 << " " << 
__FUNCTION__
 << std::
’dl
;

127 
ÿm”a_
->
	`Re£t
();

129 
i
 = 0 ; i < 
objeùNo_
 ; i++)

130 
objeùs_
[
i
]->
	`Re£t
();

131 
	}
}

133 
	gCÚŒŞËr
::
	$_Compu‹FPS
()

135 
numOfF¿me_
++;

136 
–­£dTime_
 +ğ
tim”_
.
	`StİTim”
();

137 
tim”_
.
	`S¹Tim”
();

138 if(
–­£dTime_
 > 1) {

139 
ås_
 = 
numOfF¿me_
 / 
–­£dTime_
;

141 
–­£dTime_
 = 0;

142 
numOfF¿me_
 = 0;

146 
t™ËInfo_
.
	`¡r
("");

147 
t™ËInfo_
 << 
wšdowName_
;

148 
t™ËInfo_
 << " FPS: ";

149 
t™ËInfo_
 << 
¡d
::
	`£»cisiÚ
(4è<< 
ås_
;

150 
t™ËInfo_
.
	`width
(2);

151 
	}
}

153 
	gCÚŒŞËr
::
	$R’d”
() {

156 
	`_Compu‹FPS
();

157 
	`glfwS‘WšdowT™Ë
(
wšdowHªdË_
, 
t™ËInfo_
.
	`¡r
().
	`c_¡r
() );

161 
ÿm”a_
->
	`Re£t
();

162 
i
 = 0 ; i < 
objeùNo_
 ; i++) {

163 
objeùs_
[
i
]->
	`SimuÏ‹S‹p
();

164 
objeùs_
[
i
]->
	`Show
();

170 
	}
}

172 
	gCÚŒŞËr
::
	$G‘AùiveObjeù
(
mx
, 
my
)

175  
aùiveObj_
;

176 
	}
}

178 
	gCÚŒŞËr
::
	$Qu™
() {

179 
	`glFšish
();

180 
	`glfwDe¡royWšdow
(
wšdowHªdË_
);

181 
	`ex™
(0);

182 
	}
}

185 
	gCÚŒŞËr
::
	$Resize
(
GLFWwšdow
 *
wšdow
, 
x
, 
y
) {

186 
wšX_
 = 
x
;

187 
wšY_
 = 
y
;

189 
i
 = 0 ; i < 
objeùNo_
 ; i++)

190 
objeùs_
[
i
]->
	`Resize
(
wšdow
, 
x
, 
y
);

191 
	}
}

193 
	gCÚŒŞËr
::
	$Keybßrd
(
GLFWwšdow
 * 
wšdow
, 
key
, 
sÿncode
, 
aùiÚ
, 
mods
)

195 ià(
aùiÚ
 =ğ
GLFW_PRESS
) {

196 
key
) {

197 
GLFW_KEY_ESCAPE
:

198 
	`Qu™
();

200 
GLFW_KEY_R
:

201 
	`Re£t
();

203 
GLFW_KEY_LEFT_CONTROL
:

204 
isCŒlP»s£d_
 = 
Œue
;

208 if(
aùiÚ
 =ğ
GLFW_RELEASE
)

209 
key
) {

210 
GLFW_KEY_LEFT_CONTROL
:

211 
isCŒlP»s£d_
 = 
çl£
;

214 
	}
}

217 
	gCÚŒŞËr
::
	$Mou£Bu‰Ú
(
GLFWwšdow
 *
wšdow
, 
bu‰Ú
,
aùiÚ
,
mods
)

221 if(
aùiÚ
 =ğ
GLFW_PRESS
) {

222 
	`glfwG‘CursÜPos
(
wšdow
, &
´evX_
, &
´evY_
);

225 
aùiveObj_
 = 
	`G‘AùiveObjeù
(
´evX_
, 
´evY_
);

226 
objeùs_
[
aùiveObj_
]->
	`Mou£Bu‰Ú
(
wšdow
, 
bu‰Ú
, 
aùiÚ
, 
mods
);

227 
	}
}

230 
	gCÚŒŞËr
::
	$Mou£MÙiÚ
(
GLFWwšdow
 *
wšdow
, 
nx
, 
ny
)

232 
objeùs_
[
aùiveObj_
]->
	`Mou£MÙiÚ
(
wšdow
, 
nx
, 
ny
);

233 
	}
}

	@controller.h

1 #iâdeà
CONTROLLER_H


2 
	#CONTROLLER_H


	)

4 
	~"cÜe.h
"

5 
	~"objeù.h
"

6 
	~"¬cb®l.h
"

7 
	~"ÿm”a.h
"

8 
	~"tim”.h
"

10 şas 
	cCÚŒŞËr
 {

11 
	mpublic
:

12 
CÚŒŞËr
(
¬gc
,**
¬gv
, cÚ¡ *
wšdowName
);

13 ~
CÚŒŞËr
();

15 
BegšLoİ
();

16 
Regi¡”Objeù
(
Objeù
* 
objeù
);

18 
Re£t
();

19 
R’d”
();

20 
In™Cam”a
();

22 
G‘AùiveObjeù
(
mx
, 
my
);

24 
Qu™
();

27 
Resize
(
GLFWwšdow
 *
wšdow
, 
x
, 
y
);

28 
Keybßrd
(
GLFWwšdow
 * 
wšdow
, 
key
, 
sÿncode
,
aùiÚ
, 
mods
);

29 
Mou£Bu‰Ú
(
GLFWwšdow
 *
wšdow
, 
bŠ
, 
aùiÚ
, 
mods
);

30 
Mou£MÙiÚ
(
GLFWwšdow
 *
wšdow
, 
x
, 
y
);

32 
	m´iv©e
:

34 
¡d
::
¡ršg
 
wšdowName_
;

35 
	m¡d
::
¡ršg¡»am
 
t™ËInfo_
;

36 
GLFWwšdow
 *
	mwšdowHªdË_
;

37 
	mwšX_
, 
	mwšY_
;

40 
boŞ
 
	misLeáKeyP»s£d_
, 
	misCŒlP»s£d_
, 
	misRightKeyP»s£d_
, 
	misMiddËKeyP»s£d_
;

41 
boŞ
 
	misLightOn_
;

43 
	m´evX_
, 
	m´evY_
;

45 
Objeù
** 
	mobjeùs_
;

46 
	mobjeùNo_
;

47 
	mmaxObjeùNo_
;

48 
	maùiveObj_
;

50 
Cam”a
* 
	mÿm”a_
;

52 
_Compu‹FPS
();

53 
Tim”
 
	mtim”_
;

54 
	m–­£dTime_
;

55 
	mnumOfF¿me_
;

56 
	mås_
;

	@core.h

1 #iâdeà
_CORE_H


2 
	#_CORE_H


	)

4 
	#PI
 3.14159

	)

5 
	#INF
 99999999

	)

6 
	#DEBUG_LEVEL


	)

8 
	~<cm©h
>

9 
	~<c¡dlib
>

10 
	~<c¡dio
>

11 
	~<c¡ršg
>

12 
	~<ùy³.h
>

13 
	~<²g.h
>

15 
	~<io¡»am
>

16 
	~<f¡»am
>

17 
	~<veùÜ
>

18 
	~<®gÜ™hm
>

19 
	~<m­
>

20 
	~<¡ršg
>

21 
	~<s¡»am
>

22 
	~<iomª
>

25 
	~<glm/glm.hµ
>

27 
	~<Eig’/D’£
>

28 
	~<Eig’/S·r£
>

29 
	~<Eig’/CÜe
>

30 
	~<Eig’/Geom‘ry
>

32 
	~<Eig’/S·r£ChŞesky
>

33 
	~<Eig’/S·r£QR
>

34 
	~<Eig’/S·r£LU
>

35 
	~<Eig’/I‹¿tiveLš—rSŞv”s
>

36 
	~<GL/gËw.h
>

37 
	#GLFW_INCLUDE_GLU


	)

38 
	~<GLFW/glfw3.h
>

39 
	~<O³nMesh/CÜe/IO/MeshIO.hh
>

40 
	~<O³nMesh/CÜe/Mesh/PŞyMesh_A¼ayK”ÃlT.hh
>

41 
	~<O³nMesh/CÜe/Mesh/TriMesh_A¼ayK”ÃlT.hh
>

43 
	~<GL/gl.h
>

44 
	~<GL/glu.h
>

46 
	~"ev’t_li¡’”.h
"

	@event_listener.h

1 şas 
	cEv’tLi¡’”
 {

2 
	mpublic
:

3 
vœtu®
 
Mou£Bu‰Ú
(
GLFWwšdow
 *
wšdow
, 
bu‰Ú
,
aùiÚ
,
mods
) = 0;

4 
vœtu®
 
Mou£MÙiÚ
(
GLFWwšdow
 *
wšdow
, 
nx
, 
ny
) = 0;

5 
vœtu®
 
Keybßrd
(
GLFWwšdow
 * 
wšdow
, 
key
, 
sÿncode
, 
aùiÚ
, 
mods
) = 0;

6 
vœtu®
 
Resize
(
GLFWwšdow
 *
wšdow
, 
x
, 
y
) = 0;

	@fluid.cpp

4 
	~"æuid.h
"

6 
	gFluid
::
	$Fluid
()

8 
diffusiÚ
 = 0.00001f;

9 
viscos™y
 = 0.000000f;

10 
buoyªcy
 = 4.0f;

11 
vc_•s
 = 5.0f;

12 
_dt
 = 
DT
;

14 
i
=0; i<10; i++)

15 
	`CË¬Bufãr
(
_bufãrs
[
i
]);

17 
i
=0;

18 
_d’s™y
=
_bufãrs
[
i
++]; 
_d’s™yTmp
=_buffers[i++];

19 
_v–X
=
_bufãrs
[
i
++]; 
_v–XTmp
=_buffers[i++];

20 
_v–Y
=
_bufãrs
[
i
++]; 
_v–YTmp
=_buffers[i++];

21 
_v–Z
=
_bufãrs
[
i
++]; 
_v–ZTmp
=_buffers[i++];

23 
	`CË¬Sourûs
();

25 
_»nd””
 = 
Ãw
 
	`R’d””
();

26 
	}
}

28 
	gFluid
::~
	$Fluid
()

30 
	}
}

32 
	#BOUNDARY


	)

34 
Fluid
::
	$EnfÜûBound¬y
(
b
, * 
x
)

36 #ifdeà
BOUNDARY


37 
i
, 
j
;

38 
i
=1; i<=
N
; i++)

40 
j
=1; j<=
N
; j++) {

41 
x
[
	`_I
(0,
i
,
j
)] = (
b
==1) ? -x[_I(1,i,j)] : x[_I(1,i,j)];

42 
x
[
	`_I
(
N
+1,
i
,
j
)] = (
b
==1) ? -x[_I(N,i,j)] : x[_I(N,i,j)];

43 
x
[
	`_I
(
i
,0,
j
)] = (
b
==2) ? -x[_I(i,1,j)] : x[_I(i,1,j)];

44 
x
[
	`_I
(
i
,
N
+1,
j
)] = (
b
==2) ? -x[_I(i,N,j)] : x[_I(i,N,j)];

45 
x
[
	`_I
(
i
,
j
,0)] = (
b
==3) ? -x[_I(i,j,1)] : x[_I(i,j,1)];

46 
x
[
	`_I
(
i
,
j
,
N
+1)] = (
b
==3) ? -x[_I(i,j,N)] : x[_I(i,j,N)];

50 
x
[
	`_I
(0,0,0)] = (x[_I(1,0,0)] +x[_I(0,1,0)] +x[_I(0,0,1)]) /3;

51 
x
[
	`_I
(0,
N
+1,0)] = (x[_I(1,N+1,0)] +x[_I(0,N,0)] +x[_I(0,N+1,1)]) /3;

52 
x
[
	`_I
(
N
+1,0,0)] = (x[_I(N,0,0)] +x[_I(N+1,1,0)] +x[_I(N+1,0,1)]) /3;

53 
x
[
	`_I
(
N
+1,N+1,0)] = (x[_I(N,N+1,0)] +x[_I(N+1,N,0)] +x[_I(N+1,N+1,1)])/3;

54 
x
[
	`_I
(0,0,
N
+1)] = (x[_I(1,0,N+1)] +x[_I(0,1,N+1)] +x[_I(0,0,N)]) /3;

55 
x
[
	`_I
(0,
N
+1,N+1)] = (x[_I(1,N+1,N+1)]+x[_I(0,N,N+1)] +x[_I(0,N+1,N)]) /3;

56 
x
[
	`_I
(
N
+1,0,N+1)] = (x[_I(N,0,N+1)] +x[_I(N+1,1,N+1)]+x[_I(N+1,0,N)]) /3;

57 
x
[
	`_I
(
N
+1,N+1,N+1)] = (x[_I(N,N+1,N+1)]+x[_I(N+1,N,N+1)]+x[_I(N+1,N+1,N)])/3;

59 
	}
}

61 
	gFluid
::
	$AddSourû
(* 
¤c
, *
d¡
)

63 
i
;

65 
i
=0; i<
SIZE
; i++)

66 
d¡
[
i
] +ğ
¤c
[i]*
_dt
;

67 
	}
}

69 
	gFluid
::
	$AddBuoyªcy
()

71 
i
;

73 
i
=0; i<
SIZE
; i++)

74 
_v–Y
[
i
] +ğ
_d’s™y
[i]*
buoyªcy
*
_dt
;

75 
	}
}

77 
šlše
 
	gFluid
::
	$Diffu£
(
b
, * 
x0
, * 
x
, 
diff
)

79 
l
;

80 
a
=
_dt
*
diff
*
N
*N*N;

81 
l
=0;†<20;†++)

83 
FOR_ALL_CELL
 {

84 
x
[
	`_I
(
i
,
j
,
k
)] = (
x0
[_I(i,j,k)] + 
a
*(

85 
x
[
	`_I
(
i
-1,
j
,
k
)]+x[_I(i+1,j,k)]+

86 
x
[
	`_I
(
i
,
j
-1,
k
)]+x[_I(i,j+1,k)]+

87 
x
[
	`_I
(
i
,
j
,
k
-1)]+x[_I(i,j,k+1)]))/(1+6*
a
);

88 } 
END_FOR


89 
	`EnfÜûBound¬y
(
b
,
x
);

91 
	}
}

93 
šlše
 
	gFluid
::
	$Adveù
(
b
, * 
x0
, * 
x
, * 
uu
, * 
vv
, * 
ww
)

95 
i0
, 
j0
, 
k0
, 
i1
, 
j1
, 
k1
;

96 
sx0
, 
sx1
, 
sy0
, 
sy1
, 
sz0
, 
sz1
, 
v0
, 
v1
;

97 
xx
, 
yy
, 
zz
, 
dt0
;

98 
dt0
 = 
_dt
*
N
;

99 
FOR_ALL_CELL
 {

100 
xx
 = 
i
-
dt0
*
uu
[
	`_I
(i,
j
,
k
)];

101 
yy
 = 
j
-
dt0
*
vv
[
	`_I
(
i
,j,
k
)];

102 
zz
 = 
k
-
dt0
*
ww
[
	`_I
(
i
,
j
,k)];

103 ià(
xx
<0.5èxx=0.5f; ià(xx>
N
+0.5èxx=N+0.5f; 
i0
=()xx; 
i1
=i0+1;

104 ià(
yy
<0.5èyy=0.5f; ià(yy>
N
+0.5èyy=N+0.5f; 
j0
=()yy; 
j1
=j0+1;

105 ià(
zz
<0.5èzz=0.5f; ià(zz>
N
+0.5èzz=N+0.5f; 
k0
=()zz; 
k1
=k0+1;

106 
sx1
 = 
xx
-
i0
; 
sx0
 = 1-sx1;

107 
sy1
 = 
yy
-
j0
; 
sy0
 = 1-sy1;

108 
sz1
 = 
zz
-
k0
; 
sz0
 = 1-sz1;

109 
v0
 = 
sx0
*(
sy0
*
x0
[
	`_I
(
i0
,
j0
,
k0
)]+
sy1
*x0[_I(i0,
j1
,k0)])+
sx1
*(sy0*x0[_I(
i1
,j0,k0)]+sy1*x0[_I(i1,j1,k0)]);

110 
v1
 = 
sx0
*(
sy0
*
x0
[
	`_I
(
i0
,
j0
,
k1
)]+
sy1
*x0[_I(i0,
j1
,k1)])+
sx1
*(sy0*x0[_I(
i1
,j0,k1)]+sy1*x0[_I(i1,j1,k1)]);

111 
x
[
	`_I
(
i
,
j
,
k
)] = 
sz0
*
v0
 + 
sz1
*
v1
;

112 } 
END_FOR


113 
	`EnfÜûBound¬y
(
b
,
_d’s™y
);

114 
	}
}

116 
	gFluid
::
	$Projeù
()

118 * 
p
 = 
_v–XTmp
;

119 * 
div
 = 
_v–YTmp
;

120 
l
;

121 
h
;

122 
h
 = 1.0f/
N
;

123 
FOR_ALL_CELL
 {

124 
div
[
	`_I
(
i
,
j
,
k
)] = -
h
*(

125 
_v–X
[
	`_I
(
i
+1,
j
,
k
)]-_velX[_I(i-1,j,k)]+

126 
_v–Y
[
	`_I
(
i
,
j
+1,
k
)]-_velY[_I(i,j-1,k)]+

127 
_v–Z
[
	`_I
(
i
,
j
,
k
+1)]-_velZ[_I(i,j,k-1)])/3;

128 
p
[
	`_I
(
i
,
j
,
k
)] = 0;

129 } 
END_FOR


130 
	`EnfÜûBound¬y
(0,
div
); EnfÜûBound¬y(0,
p
);

131 
l
=0;†<20;†++)

133 
FOR_ALL_CELL
 {

134 
p
[
	`_I
(
i
,
j
,
k
)] = (
div
[_I(i,j,k)]+

135 
p
[
	`_I
(
i
-1,
j
,
k
)]+p[_I(i+1,j,k)]+

136 
p
[
	`_I
(
i
,
j
-1,
k
)]+p[_I(i,j+1,k)]+

137 
p
[
	`_I
(
i
,
j
,
k
-1)]+p[_I(i,j,k+1)])/6;

138 } 
END_FOR


139 
	`EnfÜûBound¬y
(0,
p
);

141 
FOR_ALL_CELL
 {

142 
_v–X
[
	`_I
(
i
,
j
,
k
)] -ğ(
p
[_I(i+1,j,k)]-p[_I(i-1,j,k)])/3/
h
;

143 
_v–Y
[
	`_I
(
i
,
j
,
k
)] -ğ(
p
[_I(i,j+1,k)]-p[_I(i,j-1,k)])/3/
h
;

144 
_v–Z
[
	`_I
(
i
,
j
,
k
)] -ğ(
p
[_I(i,j,k+1)]-p[_I(i,j,k-1)])/3/
h
;

145 } 
END_FOR


146 
	`EnfÜûBound¬y
(1,
_v–X
); EnfÜûBound¬y(2,
_v–Y
);

147 
	}
}

149 
	gFluid
::
	$VÜtic™yCÚfšem’t
()

151 
ijk
;

152 *
cu¾x
 = 
_v–XTmp
, *
cu¾y
 = 
_v–YTmp
, *
cu¾z
=
_v–ZTmp
, *
cu¾
=
_d’s™yTmp
;

153 
dt0
 = 
_dt
 * 
vc_•s
;

154 
x
,
y
,
z
;

157 
FOR_ALL_CELL
 {

158 
ijk
 = 
	`_I
(
i
,
j
,
k
);

160 
x
 = 
cu¾x
[
ijk
] = (
_v–Z
[
	`_I
(
i
,
j
+1,
k
)] - _velZ[_I(i,j-1,k)]) * 0.5f -

161 (
_v–Y
[
	`_I
(
i
,
j
,
k
+1)] - _velY[_I(i,j,k-1)]) * 0.5f;

164 
y
 = 
cu¾y
[
ijk
] = (
_v–X
[
	`_I
(
i
,
j
,
k
+1)] - _velX[_I(i,j,k-1)]) * 0.5f -

165 (
_v–Z
[
	`_I
(
i
+1,
j
,
k
)] - _velZ[_I(i-1,j,k)]) * 0.5f;

168 
z
 = 
cu¾z
[
ijk
] = (
_v–Y
[
	`_I
(
i
+1,
j
,
k
)] - _velY[_I(i-1,j,k)]) * 0.5f -

169 (
_v–X
[
	`_I
(
i
,
j
+1,
k
)] - _velX[_I(i,j-1,k)]) * 0.5f;

172 
cu¾
[
ijk
] = 
	`sq¹f
(
x
*x+
y
*y+
z
*z);

173 } 
END_FOR


175 
FOR_ALL_CELL
 {

176 
ijk
 = 
	`_I
(
i
,
j
,
k
);

177 
Nx
 = (
cu¾
[
	`_I
(
i
+1,
j
,
k
)] - curl[_I(i-1,j,k)]) * 0.5f;

178 
Ny
 = (
cu¾
[
	`_I
(
i
,
j
+1,
k
)] - curl[_I(i,j-1,k)]) * 0.5f;

179 
Nz
 = (
cu¾
[
	`_I
(
i
,
j
,
k
+1)] - curl[_I(i,j,k-1)]) * 0.5f;

180 
Ën1
 = 1.0f/(
	`sq¹f
(
Nx
*Nx+
Ny
*Ny+
Nz
*Nz)+0.0000001f);

181 
Nx
 *ğ
Ën1
;

182 
Ny
 *ğ
Ën1
;

183 
Nz
 *ğ
Ën1
;

184 
_v–X
[
ijk
] +ğ(
Ny
*
cu¾z
[ijk] - 
Nz
*
cu¾y
[ijk]è* 
dt0
;

185 
_v–Y
[
ijk
] +ğ(
Nz
*
cu¾x
[ijk] - 
Nx
*
cu¾z
[ijk]è* 
dt0
;

186 
_v–Z
[
ijk
] +ğ(
Nx
*
cu¾y
[ijk] - 
Ny
*
cu¾x
[ijk]è* 
dt0
;

187 } 
END_FOR


188 
	}
}

190 
	#DIFFUSE


	)

191 
	#ADVECT


	)

193 
	gFluid
::
	$V–oc™yS‹p
()

196 
	`AddSourû
(
su
, 
_v–X
);

197 
	`AddSourû
(
sv
, 
_v–Y
);

198 
	`AddSourû
(
sw
, 
_v–Z
);

200 
	`AddBuoyªcy
();

201 
	`VÜtic™yCÚfšem’t
();

203 #ifdeà
DIFFUSE


204 
¡d
::
	`sw­
(
_v–XTmp
, 
_v–X
); std::sw­(
_v–YTmp
, 
_v–Y
); std::sw­(
_v–ZTmp
, 
_v–Z
);

205 
	`Diffu£
(1, 
_v–XTmp
, 
_v–X
, 
viscos™y
);

206 
	`Diffu£
(2, 
_v–YTmp
, 
_v–Y
, 
viscos™y
);

207 
	`Diffu£
(3, 
_v–ZTmp
, 
_v–Z
, 
viscos™y
);

208 
	`Projeù
();

210 #ifdeà
ADVECT


211 
¡d
::
	`sw­
(
_v–XTmp
, 
_v–X
); std::sw­(
_v–YTmp
, 
_v–Y
); std::sw­(
_v–ZTmp
, 
_v–Z
);

212 
	`Adveù
(1, 
_v–XTmp
, 
_v–X
, _v–XTmp, 
_v–YTmp
, 
_v–ZTmp
);

213 
	`Adveù
(2, 
_v–YTmp
, 
_v–Y
, 
_v–XTmp
, _v–YTmp, 
_v–ZTmp
);

214 
	`Adveù
(3, 
_v–ZTmp
, 
_v–Z
, 
_v–XTmp
, 
_v–YTmp
, _velZTmp);

215 
	`Projeù
();

217 
	}
}

219 
	gFluid
::
	$D’s™yS‹p
()

222 
	`AddSourû
(
sd
, 
_d’s™y
);

224 #ifdeà
DIFFUSE


225 
¡d
::
	`sw­
(
_d’s™yTmp
, 
_d’s™y
);

226 
	`Diffu£
(0, 
_d’s™yTmp
, 
_d’s™y
, 
diffusiÚ
);

228 #ifdeà
ADVECT


229 
¡d
::
	`sw­
(
_d’s™yTmp
, 
_d’s™y
);

230 
	`Adveù
(0, 
_d’s™yTmp
, 
_d’s™y
, 
_v–X
, 
_v–Y
, 
_v–Z
);

234 
k
=1; k<=
N
; k++) {

235 
j
=1; j<=
N
; j++) {

236 
i
=1; i<=
N
; i++) {

237 
_d’s™y
[
	`_I
(
k
,
j
,
i
)] -= 0.001;

238 if(
_d’s™y
[
	`_I
(
k
,
j
,
i
)] < 0)

239 
_d’s™y
[
	`_I
(
k
,
j
,
i
)] = 0;

246 
	}
}

248 
	gFluid
::
	$_G’”©eSmoke
()

250 cÚ¡ 
ûÁ”Y
 = 
RES
/4;

251 cÚ¡ 
ûÁ”Z
 = 
RES
/2;

252 
d’s
 = (
	`¿nd
()%1000)/1000.0f;

253 
i
 = 1 ; i <ğ
N
 ; i++) {

254 
j
 = 1 ; j <ğ
N
 ; j++) {

255 ià(
	`hypÙ
(
i
-
ûÁ”Y
, 
j
-
ûÁ”Z
è< 
RES
/10) {

256 
this
->
_d’s™y
[
	`_I
(5,
i
,
j
)] = 
d’s
;

257 
this
->
_v–X
[
	`_I
(5,
i
,
j
)] = 5.0f;

262 
	}
}

264 
	gFluid
::
	$SimuÏ‹S‹p
()

266 
	`_G’”©eSmoke
();

268 
	`V–oc™yS‹p
();

269 
	`D’s™yS‹p
();

271 
	}
}

274 
	gFluid
::
	$Show
()

277 
_»nd””
->
	`FlTextu»
(
this
);

278 
_»nd””
->
	`R’d”
();

280 
	`glBegš
(
GL_POINTS
);

281 
k
=1; k<=
N
; k++) {

282 
j
=1; j<=
N
; j++) {

283 
i
=1; i<=
N
; i++) {

284 if(!
	`ALMOST_EQUAL
(
_d’s™y
[
	`_I
(
k
,
j
,
i
)], 0) ) {

285 
	`glV”‹x3f
((()
k
/
N
-0.5)*2, (()
j
/N-0.5)*2, (()
i
/N-0.5)*2 );

290 
	`glEnd
();

292 
	}
}

295 
	gFluid
::
	$CË¬Bufãr
(* 
x
)

297 
i
=0; i<
SIZE
; i++) {

298 
x
[
i
] = 0.0f;

300 
	}
}

302 
	gFluid
::
	$CË¬Sourûs
()

304 
i
=0; i<
SIZE
; i++) {

305 
sd
[
i
] = 
su
[i] = 
sv
[i] = 0.0f;

307 
	}
}

	@fluid.h

4 #iâdeà
_FLUID_H


5 
	#_FLUID_H


	)

7 
	~"cÜe.h
"

8 
	~"objeù.h
"

9 
	~"»nd””.h
"

11 
	#DT
 0.1

	)

12 
	#RES
 40

13 
	#N
 ((
RES
)-2)

14 
	#SIZE
 ((
RES
)*(RES)*(RES))

	)

15 
	#_I
(
x
,
y
,
z
è(((z)*(
RES
)*(RES))+((y)*(RES))+(x))

	)

17 
	#FOR_ALL_CELL
 
k
=1; k<=(
N
); k++) {\

18 
j
=1; j<=(
N
); j++) {\

19 
i
=1; i<=(
N
); i++è{

	)

21 
	#END_FOR
 }}}

	)

23 
	#ALMOST_EQUAL
(
a
, 
b
è((
	`çbs
×-b)<0.00001f)?
Œue
:
çl£
)

	)

25 şas 
	cFluid
: 
public
 
Objeù


27 
´Ùeùed
:

28 
_bufãrs
[10][
SIZE
];

29 
	mpublic
:

30 *
_d’s™y
, *
	m_d’s™yTmp
;

31 *
	m_v–X
, *
	m_v–XTmp
;

32 *
	m_v–Y
, *
	m_v–YTmp
;

33 *
	m_v–Z
, *
	m_v–ZTmp
;

34 
	m_dt
;

36 
R’d””
 * 
	m_»nd””
;

38 
	m´Ùeùed
:

42 
AddSourû
(* 
¤c
, *
d¡
);

43 
AddBuoyªcy
();

44 
EnfÜûBound¬y
(
b
, * 
x
);

45 
Diffu£
(
b
, * 
x0
, * 
x
, 
diff
);

46 
Adveù
(
b
, * 
x0
, * 
x
, * 
uu
, * 
vv
, * 
ww
);

47 
Projeù
();

48 
VÜtic™yCÚfšem’t
();

50 
V–oc™yS‹p
();

51 
D’s™yS‹p
();

54 
CË¬Bufãr
(* 
x
);

55 
CË¬Sourûs
();

57 
_G’”©eSmoke
();

58 
	mpublic
:

59 
sd
[
SIZE
], 
	msu
[SIZE], 
	msv
[SIZE], 
	msw
[SIZE], 
	msT
[SIZE];

60 
	mdiffusiÚ
, 
	mviscos™y
, 
	mbuoyªcy
, 
	mvc_•s
;

62 
Fluid
();

63 ~
Fluid
();

65 
vœtu®
 
SimuÏ‹S‹p
();

66 
vœtu®
 
Show
();

	@main.cpp

1 
	~"cÜe.h
"

2 
	~"cÚŒŞËr.h
"

3 
	~"æuid.h
"

5 
	#WINDOW_NAME
 "Smoke3D"

	)

12 
CÚŒŞËr
* 
	gg_cÚŒŞËr
 = 
NULL
;

14 
	$maš
(
¬gc
, **
¬gv
) {

15 ::
g_cÚŒŞËr
 = 
Ãw
 
	`CÚŒŞËr
(
¬gc
, 
¬gv
, 
WINDOW_NAME
);

16 
Objeù
* 
objeù
 = 
Ãw
 
Fluid
;

20 
objeù
->
	`Regi¡”Shad”
(
VERTEX_PROG_NAME1
, 
GL_VERTEX_SHADER
);

21 
objeù
->
	`Regi¡”Shad”
(
FRAGMENT_PROG_NAME1
, 
GL_FRAGMENT_SHADER
);

22 
objeù
->
	`Regi¡”Shad”
(
VERTEX_PROG_NAME2
, 
GL_VERTEX_SHADER
);

23 
objeù
->
	`Regi¡”Shad”
(
FRAGMENT_PROG_NAME2
, 
GL_FRAGMENT_SHADER
);

24 
objeù
->
	`EÇbËShad”
();

27 ::
g_cÚŒŞËr
->
	`In™Cam”a
();

28 ::
g_cÚŒŞËr
->
	`Regi¡”Objeù
(
objeù
);

29 ::
g_cÚŒŞËr
->
	`BegšLoİ
();

31 
	}
}

	@object.cpp

1 
	~"cÜe.h
"

2 
	~"objeù.h
"

4 
	gObjeù
::
	$Objeù
()

6 #ifdeà
DEBUG_LEVEL


7 
¡d
::
cout
 << 
__FILE__
 << " " << 
__FUNCTION__
 << std::
’dl
;

10 
shad”Prog_
 = 0;

11 
	`mem£t
(
_hShad”s
, 0, (_hShaders) );

12 
shad”Num
 = 0;

15 
g_¡•Size
 = 0.001f;

16 
	}
}

18 
	gObjeù
::~
	$Objeù
()

20 
	}
}

23 
Objeù
::
	$LßdShad”Fe
(cÚ¡ * 
feName
, 
GLušt
 
shad”
)

25 
¡d
::
f¡»am
 
fe
;

26 
GLšt
 
comped
;

27 
size
 = 0;

28 * 
bufãr
 = 
NULL
;

30 
fe
.
	`İ’
(
feName
, 
¡d
::
ios
::
š
 | std::ios::
bš¬y
);

31 if(!
fe
) {

32 
¡d
::
û¼
 << "O³Àf" << 
feName
 << " faed!" << std::
’dl
;

37 
fe
.
	`£ekg
(0, 
¡d
::
ios
::
’d
);

38 
size
 = 
fe
.
	`‹Îg
();

39 
fe
.
	`£ekg
(0, 
¡d
::
ios
::
beg
);

40 
bufãr
 = 
Ãw
 [
size
];

42 
fe
.
	`»ad
(
bufãr
, 
size
);

44 
	`glShad”Sourû
(
shad”
, 1, (cÚ¡ 
GLch¬
 **)&
bufãr
, &
size
);

46 
d–‘e
 []
bufãr
;

47 
fe
.
	`şo£
();

50 
	}
}

52 
	gObjeù
::
	$EÇbËShad”
()

54 
	`C»©eShad”Prog¿m
();

55 
	}
}

57 
	gObjeù
::
	$RebšdShad”
(
GLušt
 
hV”‹xShad”
, GLušˆ
häagShad”
)

60 
GLšt
 
‹¡V®
;

61 
GLsizei
 
maxCouÁ
 = 2;

62 
GLsizei
 
couÁ
;

63 
GLušt
 
shad”s
[
maxCouÁ
];

66 
	`glG‘A‰achedShad”s
(
shad”Prog_
, 
maxCouÁ
, &
couÁ
, 
shad”s
);

68 
i
 = 0; i < 
couÁ
; i++) {

69 
	`glD‘achShad”
(
shad”Prog_
, 
shad”s
[
i
]);

73 
	`glBšdA‰ribLoÿtiÚ
(
shad”Prog_
, 0, "VerPos");

75 
	`glBšdA‰ribLoÿtiÚ
(
shad”Prog_
, 1, "VerClr");

77 
	`glA‰achShad”
(
shad”Prog_
, 
hV”‹xShad”
);

78 
	`glA‰achShad”
(
shad”Prog_
, 
häagShad”
);

81 
	`glLškProg¿m
(
shad”Prog_
);

84 
	`glG‘Prog¿miv
(
shad”Prog_
, 
GL_LINK_STATUS
, &
‹¡V®
);

85 if(
‹¡V®
 =ğ
GL_FALSE
) {

86 
šfoLog
[1024];

87 
	`glG‘Prog¿mInfoLog
(
shad”Prog_
, 1024, 
NULL
, 
šfoLog
);

88 
¡d
::
û¼
 << "Th´og¿m " << 
shad”Prog_


89 << " faedØlšk w™hhfŞlowšgƒ¼Ü:" << 
¡d
::
’dl


90 << 
šfoLog
 << 
¡d
::
’dl
;

91 
	`glD–‘eProg¿m
(
shad”Prog_
);

92 
	`ex™
(-1);

95 
	`glU£Prog¿m
(
shad”Prog_
);

96 
	}
}

98 
	gObjeù
::
	$C»©eShad”Prog¿m
()

100 
GLšt
 
‹¡V®
;

101 
GLušt
 
hR‘uº
;

104 
hR‘uº
 = 
	`glC»©eProg¿m
();

107 
shad”Prog_
 = 
hR‘uº
;

108 
	}
}

111 
	gObjeù
::
	$Regi¡”Shad”
(cÚ¡ * 
´ogName
, 
GL’um
 
shad”Ty³
)

114 
GLušt
 
hShad”
;

115 
GLušt
 
hR‘uº
 = 0;

116 
GLšt
 
‹¡V®
;

119 
hShad”
 = 
	`glC»©eShad”
(
shad”Ty³
);

122 if(
	`LßdShad”Fe
(
´ogName
, 
hShad”
) < 0) {

123 
	`glD–‘eShad”
(
hShad”
);

124 
¡d
::
û¼
 << "Thshad”‡ˆ" << 
´ogName


125 << " could‚Ù bfound." << 
¡d
::
’dl
;

126 
	`ex™
(-1);

130 
	`glCompeShad”
(
hShad”
);

132 
	`glG‘Shad”iv
(
hShad”
, 
GL_COMPILE_STATUS
, &
‹¡V®
);

133 if(
‹¡V®
 =ğ
GL_FALSE
) {

134 
šfoLog
[1024];

135 
	`glG‘Shad”InfoLog
(
hShad”
, 1024, 
NULL
, 
šfoLog
);

136 
¡d
::
û¼
 << "Thshad”‡ˆ" << 
´ogName


137 << " faedØcompw™hhfŞlowšgƒ¼Ü:" << 
¡d
::
’dl


138 << 
šfoLog
 << 
¡d
::
’dl
;

139 
	`glD–‘eShad”
(
hShad”
);

140 
	`ex™
(-1);

143 
	`glG‘Shad”iv
(
hShad”
, 
GL_COMPILE_STATUS
, &
‹¡V®
);

144 if(
‹¡V®
 =ğ
GL_FALSE
) {

145 
šfoLog
[1024];

146 
	`glG‘Shad”InfoLog
(
hShad”
, 1024, 
NULL
, 
šfoLog
);

147 
¡d
::
û¼
 << "Thshad”‡ˆ" << 
´ogName


148 << " faedØcompw™hhfŞlowšgƒ¼Ü:" << 
¡d
::
’dl


149 << 
šfoLog
 << 
¡d
::
’dl
;

150 
	`glD–‘eShad”
(
hShad”
);

151 
	`ex™
(-1);

154 
_hShad”s
[
shad”Num
++] = 
hShad”
;

160 
va_li¡
 
©Œibu‹Li¡
;

161 
	`va_¡¬t
(
©Œibu‹Li¡
, 
äagm’tProgName
);

163 *
szNextArg
;

164 
iArgCouÁ
 = 
	`va_¬g
(
©Œibu‹Li¡
, );

166 
i
 = 0; i < 
iArgCouÁ
; i++)

168 
šdex
 = 
	`va_¬g
(
©Œibu‹Li¡
, );

169 
szNextArg
 = 
	`va_¬g
(
©Œibu‹Li¡
, *);

170 
	`glBšdA‰ribLoÿtiÚ
(
hR‘uº
, 
šdex
, 
szNextArg
);

172 
	`va_’d
(
©Œibu‹Li¡
);

174 
	}
}

176 
	gObjeù
::
	$Regi¡”P¬’tWšdow
(
GLFWwšdow
* 
wšdowHªdË
)

178 
wšdowHªdË_
 = 
wšdowHªdË
;

179 
	}
}

181 
	gObjeù
::
	$Resize
(
GLFWwšdow
* 
wšdowHªdË
, 
x
, 
y
)

183 
¬cb®l_
.
	`S‘WidthHeight
(
x
, 
y
);

184 
	}
}

186 
	gObjeù
::
	$Mou£Bu‰Ú
(
GLFWwšdow
 *
wšdow
, 
bu‰Ú
,
aùiÚ
,
mods
)

188 
mou£X
, 
mou£Y
;

190 if(
bu‰Ú
 =ğ
GLFW_MOUSE_BUTTON_LEFT
) {

191 ::
	`glfwG‘CursÜPos
(
wšdow
, &
mou£X
, &
mou£Y
);

192 if(
aùiÚ
 =ğ
GLFW_PRESS
) {

193 
isLeáKeyP»s£d_
 = 
Œue
;

194 
¬cb®l_
.
	`S¹RÙ©iÚ
(
mou£X
, 
mou£Y
);

196 if(
aùiÚ
 =ğ
GLFW_RELEASE
) {

197 
isLeáKeyP»s£d_
 = 
çl£
;

198 
¬cb®l_
.
	`StİRÙ©iÚ
();

201 if(
bu‰Ú
 =ğ
GLFW_MOUSE_BUTTON_MIDDLE
) {

202 
isMiddËKeyP»s£d_
 = (
aùiÚ
 =ğ
GLFW_PRESS
);

204 if(
bu‰Ú
 =ğ
GLFW_MOUSE_BUTTON_RIGHT
) {

205 ià(
aùiÚ
 =ğ
GLFW_PRESS
) {

206 
isRightKeyP»s£d_
 = 
Œue
;

207 ::
	`glfwG‘CursÜPos
(
wšdow
, &
mou£X
, &
mou£Y
);

208 
¬cb®l_
.
	`S¹Zoomšg
(
mou£X
, 
mou£Y
);

210 if(
aùiÚ
 ==
GLFW_RELEASE
) {

211 
isRightKeyP»s£d_
 = 
çl£
;

212 
¬cb®l_
.
	`StİZoomšg
();

215 
	}
}

217 
	gObjeù
::
	$Mou£MÙiÚ
(
GLFWwšdow
 *
wšdow
, 
nx
, 
ny
)

219 if(
isLeáKeyP»s£d_
 && 
isCŒlP»s£d_
) {

221 if(
isLeáKeyP»s£d_
) {

222 
¬cb®l_
.
	`Upd©eRÙ©iÚ
(
nx
, 
ny
);

224 if(
isRightKeyP»s£d_
) {

225 
¬cb®l_
.
	`Upd©eZoomšg
(
nx
, 
ny
);

227 
	}
}

229 
	gObjeù
::
	$Compu‹NÜm®
(
GLæßt
 
v
[3][3], GLæßˆ
nÜm®
[])

231 
v1
[3],
v2
[3];

232 cÚ¡ 
x
 = 0;

233 cÚ¡ 
y
 = 1;

234 cÚ¡ 
z
 = 2;

237 
v1
[
x
] = 
v
[0][x] - v[1][x];

238 
v1
[
y
] = 
v
[0][y] - v[1][y];

239 
v1
[
z
] = 
v
[0][z] - v[1][z];

241 
v2
[
x
] = 
v
[1][x] - v[2][x];

242 
v2
[
y
] = 
v
[1][y] - v[2][y];

243 
v2
[
z
] = 
v
[1][z] - v[2][z];

247 
nÜm®
[
x
] = 
v1
[
y
]*
v2
[
z
] - v1[z]*v2[y];

248 
nÜm®
[
y
] = 
v1
[
z
]*
v2
[
x
] - v1[x]*v2[z];

249 
nÜm®
[
z
] = 
v1
[
x
]*
v2
[
y
] - v1[y]*v2[x];

252 
	}
}

254 
	gObjeù
::
	$Re£t
() {

255 #ifdeà
DEBUG_LEVEL


256 
¡d
::
cout
 << 
__FILE__
 << " " << 
__FUNCTION__
 << std::
’dl
;

258 
width
, 
height
;

259 
	`glfwG‘WšdowSize
(
wšdowHªdË_
, &
width
, &
height
);

260 
wšX_
 = 
width
;

261 
wšY_
 = 
height
;

262 
¬cb®l_
.
	`S‘WidthHeight
(
width
, 
height
);

265 
d•th_
 = 3.8;

266 
rÙX_
 = 10;

267 
rÙY_
 = -20;

270 
	`glM©rixMode
(
GL_MODELVIEW
);

271 
	`glLßdId’t™y
();

273 
	`glT¿n¦©ef
(0, 0, -
d•th_
);

274 
	`glRÙ©ef
(
rÙX_
, 1, 0, 0);

275 
	`glRÙ©ef
(
rÙY_
, 0, 1, 0);

277 
	}
}

279 
boŞ
 
	gObjeù
::
	$LßdFe
(* 
feName
)

281 
fe_
.
	`İ’
(
feName
);

282 ià(!
fe_
) {

283 
¡d
::
cout
 << "O³Àfe: " << 
feName
 << " faed!" << std::
’dl
;

284  
çl£
;

286 
¡d
::
cout
 << "O³Àfe: " << 
feName
 << " sucûed!" << std::
’dl
;

288  
Œue
;

289 
	}
}

291 
	gObjeù
::
	$Cube
() {

292 
	`glPŞygÚMode
(
GL_FRONT_AND_BACK
, 
GL_FILL
);

293 
GLæßt
 
v”tiûs
[][3] = { { -1.0f/2, -1.0f/2, -1.0f/2 },

298 
çûs
[][4] = { { 1, 2, 6, 5 }, { 2, 3, 7, 6 }, { 4, 5, 6, 7 },

301 
GLæßt
 
cŞÜs
[][3] = { { 0.0f, 1.0f, 1.0f }, { 1.0f, 0.0f, 1.0f },

306 
	`glBegš
(
GL_QUADS
);

307 
i
 = 0; i < 6; i++) {

311 
Eig’
::
VeùÜ3f
 
nm
;

312 
Eig’
::
VeùÜ3f
 
	`v0
(
v”tiûs
[
çûs
[
i
][0]][0], vertices[faces[i][0]][1], vertices[faces[i][0]][2]);

313 
Eig’
::
VeùÜ3f
 
	`v1
(
v”tiûs
[
çûs
[
i
][1]][0], vertices[faces[i][1]][1], vertices[faces[i][1]][2]);

314 
Eig’
::
VeùÜ3f
 
	`v2
(
v”tiûs
[
çûs
[
i
][2]][0], vertices[faces[i][2]][1], vertices[faces[i][2]][2]);

315 
Eig’
::
VeùÜ3f
 
l1
 = 
v1
-
v0
;

316 
Eig’
::
VeùÜ3f
 
l2
 = 
v2
-
v0
;

317 
nm
 = 
l1
.
	`üoss
(
l2
);

318 
nm
.
	`nÜm®ize
();

320 
	`glNÜm®3f
(
	`nm
(0),nm(1),nm(2));

321 
j
 = 0; j < 4; j++)

322 
	`glV”‹x3fv
(
v”tiûs
[
çûs
[
i
][
j
]]);

325 
	`glEnd
();

326 
	}
}

328 
	gObjeù
::
	$Show
()

330 
	`Cube
();

331 
	}
}

	@object.h

1 #iâdeà
DRAWER_H


2 
	#DRAWER_H


	)

4 
	~"cÜe.h
"

5 
	~"¬cb®l.h
"

9 şas 
	cObjeù
: 
public
 
Ev’tLi¡’”
{

10 
public
:

11 
Objeù
();

12 ~
Objeù
();

14 
Regi¡”Shad”
(cÚ¡ * 
v”‹xProgName
, 
GL’um
 
shad”Ty³
);

15 
LßdShad”Fe
(cÚ¡ * 
feName
, 
GLušt
 
shad”
);

16 
RebšdShad”
(
GLušt
 
hV”‹xShad”
, GLušˆ
häagShad”
);

17 
C»©eShad”Prog¿m
();

18 
EÇbËShad”
();

20 
rcS‘UšfÜms
();

23 
Compu‹NÜm®
(
GLæßt
 
v
[3][3], GLæßˆ
nÜm®
[]);

25 
Cube
();

27 
vœtu®
 
	$SimuÏ‹S‹p
() {};

28 
vœtu®
 
	`Show
();

29 
vœtu®
 
boŞ
 
	`LßdFe
(* 
feName
);

30 
vœtu®
 
	$Compu‹V”‹xNÜm®
(è{
	}
}

31 
vœtu®
 
Re£t
();

34 
vœtu®
 
Mou£Bu‰Ú
(
GLFWwšdow
 *
wšdow
, 
bu‰Ú
,
aùiÚ
,
mods
);

35 
vœtu®
 
Mou£MÙiÚ
(
GLFWwšdow
 *
wšdow
, 
nx
, 
ny
);

36 
vœtu®
 
	$Keybßrd
(
GLFWwšdow
 * 
wšdow
, 
key
, 
sÿncode
, 
aùiÚ
, 
mods
è{
	}
}

37 
vœtu®
 
Resize
(
GLFWwšdow
 *
wšdow
, 
x
, 
y
);

39 
Regi¡”P¬’tWšdow
(
GLFWwšdow
* 
wšdowHªdË
);

42 
GLušt
 
š™TFF1DTex
(cÚ¡ * 
f’ame
);

43 
GLušt
 
š™Faû2DTex
(GLušˆ
bfTexWidth
, GLušˆ
bfTexHeight
);

44 
GLušt
 
š™VŞ3DTex
(cÚ¡ * 
f’ame
, GLušˆ
w
, GLušˆ
h
, GLušˆ
d
);

45 
checkF¿mebufãrStus
();

46 
š™F¿meBufãr
(
GLušt
 
‹xObj
, GLušˆ
‹xWidth
, GLušˆ
‹xHeight
);

47 
»nd”
(
GL’um
 
cuÎFaû
);

49 
	g´Ùeùed
:

50 
¡d
::
f¡»am
 
fe_
;

52 
GLæßt
 
	grÙX_
;

53 
GLæßt
 
	grÙY_
;

54 
GLæßt
 
	gd•th_
;

57 
boŞ
 
	gisLeáKeyP»s£d_
, 
	gisCŒlP»s£d_
, 
	gisRightKeyP»s£d_
, 
	gisMiddËKeyP»s£d_
;

59 
Arcb®l
 
	g¬cb®l_
;

61 
GLFWwšdow
* 
	gwšdowHªdË_
;

62 
	gwšX_
, 
	gwšY_
;

64 
GLušt
 
	gshad”Prog_
;

65 
GLušt
 
	g_hShad”s
[10];

66 
	gshad”Num
;

69 
	gg_¡•Size
;

70 
GLušt
 
	gg_vao
;

71 
GLušt
 
	gg_äameBufãr
;

73 
GLušt
 
	gg_tffTexObj
;

74 
GLušt
 
	gg_bfTexObj
;

75 
GLušt
 
	gg_vŞTexObj
;

	@renderer.cpp

4 
	~"»nd””.h
"

5 
	~"æuid.h
"

8 
GLæßt
 
	gcv
[][3] = {

14 
	gedges
[12][2][3] = {

31 
	gR’d””
::
	$R’d””
()

33 
¡d
::
cout
 << 
__FILE__
 << " " << 
__FUNCTION__
 << std::
’dl
;

35 
_di¡
 = 5.0f;

36 
_å
 = 
NULL
;

37 
_‹xtu»_d©a
 = 
NULL
;

39 
_d¿w_¦iû_ouše
 = 
Œue
;

41 
	`š™_GL
();

48 
_light_dœ
[0] = 0.0f;

49 
_light_dœ
[1] = 1.0f;

50 
_light_dœ
[2] = -1.0f;

51 
	`g’_¿y_‹m¶
(
RES
);

52 
	}
}

54 
	gR’d””
::~
	$R’d””
()

56 ià(
_‹xtu»_d©a
)

57 
	`ä“
(
_‹xtu»_d©a
);

58 ià(
_å
)

59 
	`fşo£
(
_å
);

60 
	}
}

62 
	gR’d””
::
	$š™_GL
()

64 
	`glEÇbË
(
GL_TEXTURE_3D
);

65 
	`glDi§bË
(
GL_DEPTH_TEST
);

66 
	`glCuÎFaû
(
GL_FRONT
);

67 
	`glEÇbË
(
GL_BLEND
);

68 
	`glBËndFunc
(
GL_SRC_ALPHA
, 
GL_ONE_MINUS_SRC_ALPHA
);

71 
	`glG’Textu»s
(1, &
_txt
[0]);

73 
	`glAùiveTextu»ARB
(
GL_TEXTURE0_ARB
);

74 
	`glBšdTextu»
(
GL_TEXTURE_3D
, 
_txt
[0]);

75 
	`glTexP¬am‘”i
(
GL_TEXTURE_3D
, 
GL_TEXTURE_MIN_FILTER
, 
GL_LINEAR
);

76 
	`glTexP¬am‘”i
(
GL_TEXTURE_3D
, 
GL_TEXTURE_MAG_FILTER
, 
GL_LINEAR
);

77 
	`glTexP¬am‘”i
(
GL_TEXTURE_3D
, 
GL_TEXTURE_WRAP_S
,
GL_CLAMP
);

78 
	`glTexP¬am‘”i
(
GL_TEXTURE_3D
, 
GL_TEXTURE_WRAP_T
,
GL_CLAMP
);

79 
	`glTexP¬am‘”i
(
GL_TEXTURE_3D
, 
GL_TEXTURE_WRAP_R
,
GL_CLAMP
);

81 
	}
}

83 
	gR’d””
::
	$R’d”
()

85 
GLdoubË
 
m
[4][4], 
mt
[4][4];

86 
	`glG‘DoubËv
(
GL_MODELVIEW_MATRIX
, &
m
[0][0]);

88 
	`glDi§bË
(
GL_DEPTH_TEST
);

90 
	`d¿w_cube
();

92 
	`d¿w_¦iûs
(
m
, 
_d¿w_¦iû_ouše
);

94 
	}
}

97 
	gR’d””
::
	$d¿w_cube
()

99 
	`glDi§bË
(
GL_TEXTURE_3D
);

100 
	`glDi§bË
(
GL_FRAGMENT_PROGRAM_ARB
);

102 
	`glEÇbË
(
GL_CULL_FACE
);

103 
l
 = 0.5;

104 
	`glCŞÜ4f
(0.9f*
l
, 0.8f*l, 0.4f*l, 1.0f);

106 
	`glBegš
(
GL_POLYGON
);

107 
	`glV”‹x3fv
(
cv
[0]); glVertex3fv(cv[1]); glVertex3fv(cv[2]); glVertex3fv(cv[3]);

108 
	`glEnd
();

109 
	`glBegš
(
GL_POLYGON
);

110 
	`glV”‹x3fv
(
cv
[0]); glVertex3fv(cv[4]); glVertex3fv(cv[5]); glVertex3fv(cv[1]);

111 
	`glEnd
();

112 
	`glBegš
(
GL_POLYGON
);

113 
	`glV”‹x3fv
(
cv
[0]); glVertex3fv(cv[3]); glVertex3fv(cv[7]); glVertex3fv(cv[4]);

114 
	`glEnd
();

116 
	`glBegš
(
GL_POLYGON
);

117 
	`glV”‹x3fv
(
cv
[7]); glVertex3fv(cv[6]); glVertex3fv(cv[5]); glVertex3fv(cv[4]);

118 
	`glEnd
();

119 
	`glBegš
(
GL_POLYGON
);

120 
	`glV”‹x3fv
(
cv
[2]); glVertex3fv(cv[6]); glVertex3fv(cv[7]); glVertex3fv(cv[3]);

121 
	`glEnd
();

122 
	`glBegš
(
GL_POLYGON
);

123 
	`glV”‹x3fv
(
cv
[1]); glVertex3fv(cv[5]); glVertex3fv(cv[6]); glVertex3fv(cv[2]);

124 
	`glEnd
();

126 
	`glDi§bË
(
GL_CULL_FACE
);

128 
	`glBegš
(
GL_LINES
);

129 
	`glCŞÜ4f
(1.0f, 1.0f, 1.0f, 1.0f);

130 
	`glV”‹x3fv
(
cv
[0]); glVertex3fv(cv[1]);

131 
	`glV”‹x3fv
(
cv
[1]); glVertex3fv(cv[2]);

132 
	`glV”‹x3fv
(
cv
[2]); glVertex3fv(cv[3]);

133 
	`glV”‹x3fv
(
cv
[3]); glVertex3fv(cv[0]);

135 
	`glV”‹x3fv
(
cv
[4]); glVertex3fv(cv[5]);

136 
	`glV”‹x3fv
(
cv
[5]); glVertex3fv(cv[6]);

137 
	`glV”‹x3fv
(
cv
[6]); glVertex3fv(cv[7]);

138 
	`glV”‹x3fv
(
cv
[7]); glVertex3fv(cv[4]);

140 
	`glV”‹x3fv
(
cv
[0]); glVertex3fv(cv[4]);

141 
	`glV”‹x3fv
(
cv
[1]); glVertex3fv(cv[5]);

142 
	`glV”‹x3fv
(
cv
[2]); glVertex3fv(cv[6]);

143 
	`glV”‹x3fv
(
cv
[3]); glVertex3fv(cv[7]);

144 
	`glEnd
();

156 
	}
}

158 şas 
	cCÚvexcomp


160 
	m´iv©e
:

161 cÚ¡ 
Eig’
::
VeùÜ3f
 &
p0
, &
	mup
;

162 
	mpublic
:

163 
CÚvexcomp
(cÚ¡ 
Eig’
::
VeùÜ3f
& 
p0
, cÚ¡ Eig’::VeùÜ3f& 
up
è:…0Õ0), 
	$up
(
up
) {}

165 
boŞ
 
	$İ”©Ü
()(cÚ¡ 
Eig’
::
VeùÜ3f
& 
a
, cÚ¡ Eig’::VeùÜ3f& 
b
) const

167 
Eig’
::
VeùÜ3f
 
va
 = 
a
-
p0
, 
vb
 = 
b
-p0;

169  
up
.
	`dÙ
(
va
.
	`üoss
(
vb
)) >= 0;

170 
	}
}

173 
	gR’d””
::
	$d¿w_¦iûs
(
GLdoubË
 
m
[][4], 
boŞ
 
äame
)

175 
i
;

177 
Eig’
::
VeùÜ3f
 
	`v›wdœ
(
m
[0][2], m[1][2], m[2][2]);

178 
v›wdœ
.
	`nÜm®ize
();

180 
i
=0; i<8; i++) {

181 
x
 = 
cv
[
i
][0] + 
v›wdœ
[0];

182 
y
 = 
cv
[
i
][1] + 
v›wdœ
[1];

183 
z
 = 
cv
[
i
][2] + 
v›wdœ
[2];

184 ià((
x
>=-1.0f)&&(x<=1.0f)

185 &&(
y
>=-1.0f)&&(y<=1.0f)

186 &&(
z
>=-1.0f)&&(z<=1.0f))

191 
	`as£¹
(
i
 != 8);

197 
d0
 = -(
v›wdœ
[0]*
cv
[
i
][0] + viewdir[1]*cv[i][1] + viewdir[2]*cv[i][2]);

198 
dd
 = 2*
d0
/64.0f;

199 
n
 = 0;

200 
d
 = -
d0
; d < d0; d +ğ
dd
) {

203 
¡d
::
veùÜ
<
Eig’
::
VeùÜ3f
> 
±
 = 
	`š‹r£ù_edges
(
v›wdœ
[0], v›wdœ[1], v›wdœ[2], 
d
);

205 ià(
±
.
	`size
() > 2) {

207 
¡d
::
	`sÜt
(
±
.
	`begš
()+1,…t.
	`’d
(), 
	`CÚvexcomp
Õt[0], 
v›wdœ
));

209 
	`glEÇbË
(
GL_TEXTURE_3D
);

210 
	`glBegš
(
GL_POLYGON
);

211 
i
=0; i<
±
.
	`size
(); i++){

212 
	`glCŞÜ3f
(1.0, 1.0, 1.0);

213 
	`glTexCoÜd3d
((
±
[
i
][0]+1.0)/2.0, (pt[i][1]+1)/2.0, (pt[i][2]+1.0)/2.0);

214 
	`glV”‹x3f
(
±
[
i
][0],…t[i][1],…t[i][2]);

216 
	`glEnd
();

219 
äame
 = 
çl£
;

220 ià(
äame
)

222 
	`glDi§bË
(
GL_TEXTURE_3D
);

223 
	`glPŞygÚMode
(
GL_FRONT_AND_BACK
, 
GL_LINE
);

224 
	`glBegš
(
GL_POLYGON
);

225 
i
=0; i<
±
.
	`size
(); i++) {

226 
	`glCŞÜ3f
(0.0, 0.0, 1.0);

227 
	`glV”‹x3f
(
±
[
i
][0],…t[i][1],…t[i][2]);

229 
	`glEnd
();

230 
	`glPŞygÚMode
(
GL_FRONT_AND_BACK
, 
GL_FILL
);

234 
n
++;

236 
	}
}

238 
	g¡d
::
veùÜ
<
Eig’
::
VeùÜ3f
> 
R’d””
::
	$š‹r£ù_edges
(
a
, 
b
, 
c
, 
d
)

240 
i
;

241 
t
;

242 
Eig’
::
VeùÜ3f
 
p
;

243 
¡d
::
veùÜ
<
Eig’
::
VeùÜ3f
> 
»s
;

245 
i
=0; i<12; i++) {

246 
t
 = -(
a
*
edges
[
i
][0][0] + 
b
*edges[i][0][1] + 
c
*edges[i][0][2] + 
d
)

247 / (
a
*
edges
[
i
][1][0] + 
b
*edges[i][1][1] + 
c
*edges[i][1][2]);

248 ià((
t
>0)&&(t<2)) {

249 
p
[0] = 
edges
[
i
][0][0] +ƒdges[i][1][0]*
t
;

250 
p
[1] = 
edges
[
i
][0][1] +ƒdges[i][1][1]*
t
;

251 
p
[2] = 
edges
[
i
][0][2] +ƒdges[i][1][2]*
t
;

252 
»s
.
	`push_back
(
p
);

256  
»s
;

257 
	}
}

260 
	gR’d””
::
	$FlTextu»
(
Fluid
* 
æuid
)

262 ià(
_‹xtu»_d©a
 =ğ
NULL
)

263 
_‹xtu»_d©a
 = (*è
	`m®loc
(
RES
*RES*RES*4);

265 * 
l
 = (*è
	`m®loc
(
RES
*RES*RES);

266 
	`mem£t
(
l
,0,
RES
*RES*RES);

267 
	`ÿ¡_light
(
RES
, 
æuid
->
_d’s™y
, 
l
);

269 
i
=0; i<
RES
*RES*RES; i++) {

271 
c
 = 
l
[
i
];

273 
c
 = 200-
æuid
->
_d’s™y
[
i
];

275 
_‹xtu»_d©a
[(
i
<<2)] = 
c
;

276 
_‹xtu»_d©a
[(
i
<<2)+1] = 
c
;

277 
_‹xtu»_d©a
[(
i
<<2)+2] = 
c
;

278 
_‹xtu»_d©a
[(
i
<<2)+3] = (
æuid
->
_d’s™y
[i]>0.1f) ? 255 : () (fluid->_density[i]*2550.0f);

281 
	`ä“
(
l
);

283 
	`glAùiveTextu»ARB
(
GL_TEXTURE0_ARB
);

284 
	`glTexImage3D
(
GL_TEXTURE_3D
, 0, 
GL_RGBA
, 
RES
, RES, RES, 0, GL_RGBA, 
GL_UNSIGNED_BYTE
, 
_‹xtu»_d©a
);

285 
	}
}

287 
	gR’d””
::
	$g’_¿y_‹m¶
(
edg–’
)

289 
_¿y_‹m¶
[0][0] = _ray_templ[0][2] = _ray_templ[0][2] = 0;

290 
fx
 = 0.0f, 
fy
 = 0.0f, 
fz
 = 0.0f;

291 
x
 = 0, 
y
 = 0, 
z
 = 0;

292 
lx
 = 
_light_dœ
[0] + 0.000001f, 
ly
 = _light_dœ[1] + 0.000001f, 
lz
 = _light_dir[2] + 0.000001f;

293 
xšc
 = (
lx
 > 0) ? 1 : -1;

294 
yšc
 = (
ly
 > 0) ? 1 : -1;

295 
zšc
 = (
lz
 > 0) ? 1 : -1;

296 
tx
, 
ty
, 
tz
;

297 
i
 = 1;

298 
Ën
 = 0;

299 
maxËn
 = 3*
edg–’
*edgelen;

300 
Ën
 <ğ
maxËn
)

303 
tx
 = (
x
+
xšc
-
fx
)/
lx
;

304 
ty
 = (
y
+
yšc
-
fy
)/
ly
;

305 
tz
 = (
z
+
zšc
-
fz
)/
lz
;

307 ià((
tx
<=
ty
)&&Ñx<=
tz
)) {

308 
_¿y_‹m¶
[
i
][0] = _¿y_‹m¶[i-1][0] + 
xšc
;

309 
x
 =+ 
xšc
;

310 
fx
 = 
x
;

312 ià(
	`ALMOST_EQUAL
(
ty
,
tx
)) {

313 
_¿y_‹m¶
[
i
][1] = _¿y_‹m¶[i-1][1] + 
yšc
;

314 
y
 +ğ
yšc
;

315 
fy
 = 
y
;

317 
_¿y_‹m¶
[
i
][1] = _ray_templ[i-1][1];

318 
fy
 +ğ
tx
*
ly
;

321 ià(
	`ALMOST_EQUAL
(
tz
,
tx
)) {

322 
_¿y_‹m¶
[
i
][2] = _¿y_‹m¶[i-1][2] + 
zšc
;

323 
z
 +ğ
zšc
;

324 
fz
 = 
z
;

326 
_¿y_‹m¶
[
i
][2] = _ray_templ[i-1][2];

327 
fz
 +ğ
tx
*
lz
;

329 } ià((
ty
<
tx
)&&Ñy<=
tz
)) {

330 
_¿y_‹m¶
[
i
][0] = _ray_templ[i-1][0];

331 
fx
 +ğ
ty
*
lx
;

333 
_¿y_‹m¶
[
i
][1] = _¿y_‹m¶[i-1][1] + 
yšc
;

334 
y
 +ğ
yšc
;

335 
fy
 = 
y
;

337 ià(
	`ALMOST_EQUAL
(
tz
,
ty
)) {

338 
_¿y_‹m¶
[
i
][2] = _¿y_‹m¶[i-1][2] + 
zšc
;

339 
z
 +ğ
zšc
;

340 
fz
 = 
z
;

342 
_¿y_‹m¶
[
i
][2] = _ray_templ[i-1][2];

343 
fz
 +ğ
ty
*
lz
;

346 
	`as£¹
((
tz
<
tx
)&&Ñz<
ty
));

347 
_¿y_‹m¶
[
i
][0] = _ray_templ[i-1][0];

348 
fx
 +ğ
tz
*
lx
;

349 
_¿y_‹m¶
[
i
][1] = _ray_templ[i-1][1];

350 
fy
 +ğ
tz
*
ly
;

351 
_¿y_‹m¶
[
i
][2] = _¿y_‹m¶[i-1][2] + 
zšc
;

352 
z
 +ğ
zšc
;

353 
fz
 = 
z
;

356 
Ën
 = 
_¿y_‹m¶
[
i
][0]*_ray_templ[i][0]

357 + 
_¿y_‹m¶
[
i
][1]*_ray_templ[i][1]

358 + 
_¿y_‹m¶
[
i
][2]*_ray_templ[i][2];

359 
i
++;

361 
	}
}

363 
	#DECAY
 0.06f

	)

364 
	gR’d””
::
	$ÿ¡_light
(
n
 , * 
d’s
, * 
š‹ns™y
)

367 
i
,
j
;

368 
sx
 = (
_light_dœ
[0]>0è? 0 : 
n
-1;

369 
sy
 = (
_light_dœ
[1]>0è? 0 : 
n
-1;

370 
sz
 = (
_light_dœ
[2]>0è? 0 : 
n
-1;

372 
deÿy
 = 1.0f/(
n
*
DECAY
);

374 
i
=0; i<
n
; i++)

375 
j
=0; j<
n
; j++) {

376 ià(!
	`ALMOST_EQUAL
(
_light_dœ
[0], 0))

377 
	`light_¿y
(
sx
,
i
,
j
,
n
,
deÿy
,
d’s
,
š‹ns™y
);

378 ià(!
	`ALMOST_EQUAL
(
_light_dœ
[1], 0))

379 
	`light_¿y
(
i
,
sy
,
j
,
n
,
deÿy
,
d’s
,
š‹ns™y
);

380 ià(!
	`ALMOST_EQUAL
(
_light_dœ
[2], 0))

381 
	`light_¿y
(
i
,
j
,
sz
,
n
,
deÿy
,
d’s
,
š‹ns™y
);

383 
	}
}

386 
	#AMBIENT
 100

	)

387 
šlše
 
	gR’d””
::
	$light_¿y
(
x
, 
y
, 
z
, 
n
, 
deÿy
, * 
d’s
, * 
š‹ns™y
)

389 
xx
 = 
x
, 
yy
 = 
y
, 
zz
 = 
z
, 
i
 = 0;

390 
off£t
;

392 
l
 = 200;

393 
d
;

396 
off£t
 = ((
zz
*
n
è+ 
yy
)*À+ 
xx
;

397 ià(
š‹ns™y
[
off£t
] > 0)

398 
š‹ns™y
[
off£t
] = (è((š‹ns™y[off£t] + 
l
)*0.5f);

400 
š‹ns™y
[
off£t
] = (è
l
;

401 
d
 = 
d’s
[
off£t
]*255.0f;

402 ià(
l
 > 
AMBIENT
) {

403 
l
 -ğ
d
*
deÿy
;

404 ià(
l
 < 
AMBIENT
)

405 
l
 = 
AMBIENT
;

408 
i
++;

409 
xx
 = 
x
 + 
_¿y_‹m¶
[
i
][0];

410 
yy
 = 
y
 + 
_¿y_‹m¶
[
i
][1];

411 
zz
 = 
z
 + 
_¿y_‹m¶
[
i
][2];

412 } (
xx
>=0)&&(xx<
n
)&&(
yy
>=0)&&(yy<n)&&(
zz
>=0)&&(zz<n));

413 
	}
}

	@renderer.h

4 #iâdeà
_RENDERER_H


5 
	#_RENDERER_H


	)

7 
	~"cÜe.h
"

9 
şass
 
	gFluid
;

11 
	#ALMOST_EQUAL
(
a
, 
b
è((
	`çbs
×-b)<0.00001f)?
Œue
:
çl£
)

	)

13 şas 
	cR’d””


15 
	m´iv©e
:

16 
_sx
, 
	m_sy
;

17 
	m_ax
, 
	m_ay
;

19 
	m_qu©
[4];

20 
	m_lqu©
[4];

21 
	m_di¡
;

23 
FILE
* 
	m_å
;

24 
	m_N
;

25 
	m_näames
;

26 
	m_cur_äame
;

29 * 
	m_‹xtu»_d©a
;

30 
	m_txt
[3];

31 
	m_´og
[2];

32 
	m_fÚt_ba£
;

33 
	m_³r¥_m
[16], 
	m_Ütho_m
[16];

35 
	m_light_dœ
[3];

36 
	m_¿y_‹m¶
[4096][3];

39 
d¿w_cube
();

43 
d¿w_¦iûs
(
GLdoubË
 
m
[][4], 
boŞ
 
äame
);

45 
	m¡d
::
veùÜ
<
Eig’
::
VeùÜ3f
> 
š‹r£ù_edges
(
a
, 
b
, 
c
, 
d
);

47 
g’_¿y_‹m¶
(
edg–’
);

48 
ÿ¡_light
(
edg–’
, * 
d’s
, * 
š‹ns™y
);

49 
šlše
 
light_¿y
(
x
, 
y
, 
z
, 
n
, 
deÿy
, * 
d’s
, * 
š‹ns™y
);

52 
š™_GL
();

54 
	mpublic
:

55 
R’d””
();

56 ~
R’d””
();

58 
boŞ
 
	m_d¿w_¦iû_ouše
;

59 * 
	m_di¥¡ršg
;

61 
FlTextu»
(
Fluid
* 
æuid
);

62 
R’d”
();

	@timer.cpp

1 
	~"cÜe.h
"

2 
	~"tim”.h
"

5 
	gTim”
::
	$Tim”
()

7 
¡¬tTime_
 = 
¡İTime_
 = 
–­£dTime_
 = 0;

8 
	}
}

10 
	gTim”
::
	$S¹Tim”
()

12 
¡¬tTime_
 = 
	`glfwG‘Time
();

13 
	}
}

15 
	gTim”
::
	$StİTim”
()

17 
¡İTime_
 = 
	`glfwG‘Time
();

18  (
¡İTime_
 - 
¡¬tTime_
);

19 
	}
}

	@timer.h

1 
	~"cÜe.h
"

3 şas 
	cTim”
 {

4 
	mpublic
:

5 
Tim”
();

6 
S¹Tim”
();

7 
StİTim”
();

8 
	m´iv©e
:

9 
¡¬tTime_
;

10 
	m¡İTime_
;

11 
	m–­£dTime_
;

	@
1
.
0
17
183
arcball.cpp
arcball.h
camera.cpp
camera.h
controller.cpp
controller.h
core.h
event_listener.h
fluid.cpp
fluid.h
main.cpp
object.cpp
object.h
renderer.cpp
renderer.h
timer.cpp
timer.h
